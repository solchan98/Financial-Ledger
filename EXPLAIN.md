# 설계 및 구현
## ACCOUNT
### 회원가입
회원 가입은 요구사항에 필요한 요소만 추려 **이메일 비밀번호** 그리고 **이름**을 받도록 하였습니다.  
이메일은 이메일 형식에 맞도록, 비밀번호는 8자 이상의 규칙을 설정하였습니다.  
중복 체크는 이메일을 통해 진행하였습니다.  
이메일 혹은 비밀번호가 빈 값("")으로 오는 경우 확인 메세지를 응답합니다.
### 로그인 및 토큰 재발급
로그인은 Json Wen Token을 사용하여 진행하였습니다.  
로그인을 진행하면 AccessToken과 RefreshToken을 발급합니다.  
Access는 3hour, Refresh는 3day의 유효기간을 갖습니다.  
발급 된 RefreshToken은 Redis를 통해 key: 이메일 value: token으로 저장됩니다.  
토큰 재발급은 RefreshToken을 통해 email로 토큰이 존재하는지, 요청 된 토큰과 같은지 비교 후 재발급합니다.  
Redis에 넣을 때 토큰의 남은 유효시간에 비례해 사라지도록 설정하여 추가적인 토큰 검증은 진행하지 않습니다.
발급된 RefreshToken은 Redis에 저장됩니다.(기존 토큰은 덮어져 사라짐)  
현재 권한은 ROLE_USER 하나만 있다고 가정하고 통합적으로 부여하고 있습니다.  
마지막 로그인을 기록하여 로그인 기록을 관리합니다.
### 로그아웃
JWT는 직접적으로 만료시킬 수 없습니다. 따라서 BlackList 방법을 활용하였습니다.  
로그아웃 요청이 들어오면 해당 AccessToken을 Redis에 key: token value: "BlackList"로 저장합니다.  
저장할 때 토큰의 남은 유효시간을 계산하여 만료시간이 되면 Redis에서 사라지도록 설정합니다.  
이후 Redis에 저장 된 RefreshToken을 삭제합니다.  
이렇게 로그아웃이 진행되고 로그아웃으로 인한 AccessToken을 관리합니다.
## Ledger
가계부 내역은 언제든 복구가 가능해야합니다.  
따라서 실제 삭제를 하는 것이 아닌 isDelete 속성을 통해 삭제 여부 설정으로 진행하였습니다.  
삭제-복구 내역을 관리하기 위해 추가적인 도메인을 통해 관리합니다.
### 생성
생성은 일반적인 요구사항의 데이터에 맞게 요청받아 생성됩니다.  
추가적으로 생성일, 작성일, 마지막 수정일을 기록하여 관리합니다.  
요청 데이터가 빈 값("")의 경우 예외 메세지를 응답합니다.
### 수정
수정 또한 생성과 비슷한 로직으로 진행됩니다.
### 조회(단일, 전체, Date기준 전체 조회)
단일 조회의 경우 가계부 내역의 모든 속성을 응답합니다.  
전체 조회의 경우 가계부의 일부 내역을 추려 가계부 내역 전체를 리스트로 응답합니다.
Date기준 조회의 경우 년과 월을 받아 해당되는 가계부의 일부 내역을 추려 가계부 내역을 리스트로 응답합니다.
### 삭제
삭제의 경우 직접 삭제되는 것이 아닌 isDelete 속성을 통해 설정됩니다.  
자신의 내역이 아니거나 존재하지 않는 경우 예외 메세지를 응답합니다.
삭제-복구 내역의 삭제 데이터로 기록이 됩니다.
### 복구
복구의 경우 삭제-복구 내역 테이블에 데이터가 존재하는 지 체크한 후 isDelete 속성을 통해 복구됩니다.
자신의 내역이 아니거나 존재하지 않는 경우 예외 메세지를 응답합니다.
역시 삭제-복구 내역의 복구 데이타로 기록이 됩니다.
## TrashBasketHistory
삭제 및 복구 내역을 기록하는 도메인입니다.
조회 API만 제공합니다.
전체 조회, 삭제 내역 조회, 복구 내역 조회 총 3개의 API를 제공합니다.
## Test
처음으로 BDD를 수행하였습니다.  
BDD는 TDD를 좀 더 행위 기반으로 작성되는 개발 방식을 의미하는데 BDDMockito를 통해 진행하였습니다.  
깊은 테스트 케이스를 작성하지는 않았고 기본적인 서비스 로직 테스트 케이스를 작성하였습니다.  
메서드를 재사용하는 경우가 많아 중복되는 메서드만 사용하는 경우에는 테스트 케이스를 따로 작성하지 않았습니다.  (레포지토리 및 MVC테스트의 경우에는 모두 수행해야 합니다.)
## 설정 및 부가 관리
### 도메인 설계
도메인은 요구사항에 따라 필요하다고 생각되는 도메인을 작성하였습니다.  
ERD 툴은 ERD Cloud를 사용하였습니다.
### 응답
응답 형식은 모든 응답을 통일화 하였습니다.  
응답 데이터가 있는 경우, 응답 객체와 Message객체를 하나의 필드로 갖는 DTO를 응답합니다.  
응답 데이터가 없는 경우, Message객체를 응답합니다.
상태 및 응답 메세지는 커스텀하여 사용되며 Enum 및 상수로 처리하여 사용됩니다.  
모든 응답(예외 포함)은 커스텀한 상태코드와 메세지를 갖습니다.
### 예외 처리
최대한 발생 가능한 예외를 찾아 테스트케이스 작성 및 예외처리 진행하였습니다.  
모든 예외는 각 상황에 맞는 예외를 커스텀하여 사용됩니다.
각 도메인 별 예외 핸들러를 통해 예외를 핸들링합니다.
### Docker 기반 실행 환경 구성
기본적으로 Dockerfile을 통해 최종 마무리된 프로젝트를 빌드하여 docker hub에 올려놓았습니다.  
MySQL과 Redis 모두 Docker를 통해 구성하여 사용하였습니다.  
위 실행 환경을 쉽게 구성 및 사용할 수 있도록 docker-coompose를 통해 통합 실행을 하도록 구성하였습니다.  
MySQL -> Redis -> SpringBoot Application 순으로 실행됩니다.